## 前のセクションのレビュー

前のセクションの課題を覚えていますか？私たちはタスクコレクションの **ステータス** と **添付** フィールドを設定し、それらをタスクリストに表示しました。解決策を明らかにしましょう！

1. **ステータスフィールドの設定**：
   - [**単一選択**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/choices/select) フィールドを選択し、以下のオプションを入力します：**未開始、進行中、レビュー中、完了、キャンセル、アーカイブ済み**。お好みの色を選んで、タスクに色を添えましょう！

![ステータスフィールド設定](https://static-docs.nocobase.com/Solution/202411062259171730905157.png)

2. **添付フィールドの設定**：
   - 新しい[**添付**](https://docs-cn.nocobase.com/handbook/file-manager/field-attachment)フィールドを作成し、「添付」という名前を付けて送信ボタンを押すだけ。シンプルですね！

![](https://static-docs.nocobase.com/Solution/202411062305571730905557.png)

3. **タスクリストに作成者とステータスを表示**：
   - 「列の設定」で「作成者」、「ステータス」、「添付」フィールドを選択し、タスクリストに重要な情報を表示します。

![タスクリストのフィールド表示](https://static-docs.nocobase.com/Solution/202411062312011730905921.png)

4. **追加および編集フォームにフィールドを表示**：
   - ポップアップフォームでステータスと添付フィールドを選択するのを忘れずに、タスクを追加または編集するときにこれらのフィールドが簡単に見えるようにします。

![フォームのフィールド表示](https://static-docs.nocobase.com/Solution/202411062314531730906093.png)

うまくいきましたね！これらのステップを繰り返し練習して、NocoBaseの主要機能に慣れていきましょう。それぞれのステップが、将来のタスク管理のための堅固な基盤を築きます。進んでいきましょう！

---

## 4.1 タスク内容とコメント：インタラクティブなタスク管理

これまでのところ、あなたのタスク管理システムは基本的なタスク情報を扱えます。しかし、タスク管理は単なる数行のテキスト以上のものが必要です。時には、より豊かな内容やチームメンバー間のリアルタイムの相互作用が必要です。

### 4.1.1 マークダウン (Vditor)：タスク内容をより堅牢に

NocoBaseが提供する[**リッチテキスト**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/media/rich-text)や[**マークダウン**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/media/markdown)エディターに注目したかもしれませんが、あまり満足できないかもしれません。リッチテキストエディターは少し機能が限られており、マークダウンエディターは使いやすいですが、リアルタイムプレビューをサポートしていません。

![](https://static-docs.nocobase.com/Solution/202411062320261730906426.png)

リアルタイムプレビューと豊富な機能を兼ね備えたエディターはあるのでしょうか？もちろん！[**Markdown (Vditor)**](https://docs.nocobase.com/handbook/field-markdown-vditor)はNocoBaseで最も強力なテキストエディターで、リアルタイムプレビュー、画像アップロード、さらには音声録音さえも提供しています。しかも、システムに組み込まれていて完全に無料です！

> **Markdown(Vditor)**：Markdownを保存し、Vditorエディターを使用してレンダリングします。リスト、コード、引用などの一般的なMarkdown構文をサポートし、画像や録音などのアップロードもサポートします。また、即時レンダリングを可能にし、見たままがそのままとなります。

この強力なエディターの有効化を段階的に説明しましょう。プラグインマネージャーを覚えていますか？そこにありますよ！

1. **Markdown (Vditor) プラグインの有効化**：
   - 右上の **プラグインマネージャー**を開き、プラグイン内で「markdown」を検索して、[**Markdown (Vditor)**](https://docs.nocobase.com/handbook/field-markdown-vditor)を有効にします。ページが一時的にリフレッシュすることを心配しないでください – 数秒後には戻ってきます。

![Markdownプラグインを有効にする](https://static-docs.nocobase.com/Solution/202411062323421730906622.png)

2. **マークダウンフィールドを作成する**：
   - タスクコレクションに戻り、「フィールドを追加」をクリックすると、私たちのMarkdown Pro Plusが準備完了です！

![](https://static-docs.nocobase.com/Solution/202411062327441730906864.png)

- フィールドに名前を付けます、「タスク詳細（task_detail）」などとし、利用可能なすべての機能を有効にします。

3. 「ファイルコレクション」というオプションがありますが、選択しないとファイル機能に影響が出るのでしょうか？心配いりません。ファイルはデフォルトのストレージに保存されますので、安心して使用できます。

![](https://static-docs.nocobase.com/Solution/202411062330401730907040.png)

4. **マークダウンフィールドをテストする**：
   - タスク管理ページに戻り、最初のマークダウンテキストを作成しましょう！画像をペーストしたり、ファイルをアップロードしてみてください。非常に強力ですね！

![](https://static-docs.nocobase.com/Solution/202411062335541730907354.png)

あなたのタスクコレクションはより多機能になってきています！各ステップを踏むごとに、システムの機能が拡張されます。次は、よりクリーンなインターフェースのためにフィールドの配置を調整する方法を探りましょう。

### 4.1.2 フィールドレイアウトの調整

タスクコレクションにフィールドが増えると、ページレイアウトが混乱することがあります。心配はいりません。NocoBaseの柔軟性により、フィールドの配置を簡単に再配置できます。

**フィールドの位置を調整する**：

- フィールドの右上隅にある十字アイコンにカーソルを合わせてクリックし、希望する位置までドラッグします。その後、解放して調整を完了します。ページがすぐにきれいになりましたか？

![フィールドの位置を調整する](https://static-docs.nocobase.com/Solution/demovv4-013.gif)

この調整で、ページのレイアウトがあなたの好みに合わせられます。続いて、チームのコラボレーションをさらに容易にするために、タスクコレクションにコメント機能を追加しましょう。

## 4.2 コメント機能

タスクの説明があることは助かりますが、時にはチームメンバーがコメントを追加したり、問題を議論したり、フィードバックを記録する必要があります。一緒にこれを実装しましょう。

### 4.2.1 方法1：コメントプラグインの使用

#### 4.2.1.1 コメントプラグインのインストール

> **コメントプラグイン (商用プラグイン)**：**任意のコレクションにコメント機能を追加するためのコメントコレクションテンプレートとブロックを提供します。**
>
> 注意：コメントを追加する際は、データの競合を防ぐために、ターゲットコレクションをリレーションシップフィールドを通じてリンクしてください。

[**プラグインマネージャー**](https://docs.nocobase.com/handbook/plugin-manager)で、**コメントプラグイン**をアップロードして有効にします。プラグインが有効化されると、新しい「コメントコレクション」オプションがデータソースに表示されます。新規追加（追加と更新）> プラグインをアップロード > zipファイルをドラッグ > 送信をクリックします。コメントを検索すると、コメントプラグインが見えるはずです！有効にすると、データソース内にコメントコレクションオプションが表示され、インストール成功です！

![コメントプラグインをインストール](https://static-docs.nocobase.com/Solution/demovv4-014-one.gif)

![コメントプラグインを表示](https://static-docs.nocobase.com/Solution/demovv4-014-two.gif)

#### 4.2.1.2 コメントコレクションの作成

データソースに切り替え、**コメント**と呼ばれる新しいコメントデータコレクションを作成します。

#### 4.2.1.3 コメントとタスクコレクションとの関係を探る

**コメントコレクション**を作成したので、ページにコメントセクションを追加できるかもしれません。また、コメントとタスクのリレーションシップは**多対一**です。コメントをタスクにリンクさせるにはどうしますか？

正解です！[**リレーションシップフィールド**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/associations)を使用して、この接続をNocoBaseで構築します。

NocoBaseでは、データレベルでコレクション間のリンクを確立するためにリレーションシップフィールドを使用でき、関連するデータを緊密に接続する架け橋のように機能します。

![](https://static-docs.nocobase.com/Solution/demovv4-015.gif)

**なぜ多対一のリレーションシップを選ぶのか？**

私たちは[**多対一**](https://docs.nocobase.com/handbook/data-modeling/collection-fields/associations/m2o)のリレーションシップを選ぶことにしたのでしょうか？それは、**各タスクには複数のコメントがあるため**、複数のコメントが同じタスクを指すことができるからです。この場合、コメントコレクションにタスクコレクションのタスクにリンクする**多対一**フィールドを作成することが必要です。

> おそらく賢いあなたは気づいたでしょう：
> コメントとタスクには多対一のリレーションシップがあるので、タスクコレクションにコメントコレクションを指す**一対多**のフィールドも作成できますか？
> **その通りです、よくやりました！** 一対多と多対一は相互関係にあるので、タスクコレクションにコメントコレクションをリンクする一対多のフィールドを作成できます。あなたは素晴らしいです！

#### 4.2.1.4 多対一のリレーションシップフィールドを設定する

次に、コメントコレクションに多対一フィールドを作成し、タスクコレクションとのリンクをされます。これを**関連タスク (belong_task)**と名付けます。設定中に注意が必要な主な要件は次のとおりです：

1. **ソースコレクション**：関係が開始される場所はどこですか？この場合、コメントコレクションです。
2. **ターゲットコレクション**：どのコレクションにリンクするのでしょうか？ここではタスクコレクションです。

> **外部キーおよびターゲットコレクションフィールド識別の例：**
> ここでクリアにする必要があります。
>
> 高校の成績証明書の積み重ねを処理していると仮定し、それぞれの成績証明書をその学生にリンクさせるのが仕事です。とある成績証明書には、次の情報があります：
>
> - **名前**：張三
> - **クラス**：3年生35クラス
> - **試験番号**：202300000001
> - **ID番号**：111111111111
>
> 名前やクラスを使って張三を見つけたいと仮定します。しかし、クラス内には名前が同じ学生が多く、正確に特定するのが難しいかもしれません。
>
> **そのため固有の識別子である試験番号が役立ちます。** 試験番号を使うことで、特定の学生の成績証明書を正確に特定できます。たとえば、「202300000001」の試験番号で検索した場合、学校はすぐに「この成績証明書は張三に所属し、高校35クラスの3列目にいるメガネをかけた彼だ」と返答します。
>
> 同様の論理が**コメント**の関係設計にも当てはまります。タスクコレクションからの一意の識別子（たとえば、**ID**）をコメントに保存して、各コメントが該当するタスクにリンクできるか、すぐに考えましたか？
>
> これが多対一関係を実装する核心概念であり、シンプルですね。

コメントコレクションにタスクコレクションの一意の**task_id**フィールドを保存して、コメントを関連タスクと結びつけます。

#### 4.2.1.5 削除時の外部キー処理

NocoBaseで多対一のリレーションシップを設定した後、タスクが削除された場合、コメントがどうなるかを考慮する必要があります。次のオプションがあります：

- **CASCADE**：タスクが削除されると、そのタスクに関連するすべてのコメントも削除されます。
- **SET NULL**（デフォルト設定）：タスクが削除されると、コメントデータは保持されますが、外部キーはNULLに設定されます。
- **RESTRICTおよびNO ACTION**：タスクに関連するコメントがある場合、システムはそのタスクを削除できなくします。これにより、コメントが失われないようにします。

#### 4.2.1.6 タスクコレクション内の逆関係を作成

最後に、**ターゲットコレクション内の逆関係フィールドを作成**を選択して、タスク内からすべての関連コメントを簡単に表示できるようにします。これによってデータ管理の効率が向上します。

NocoBaseでのリレーションシップフィールドの配置は、データにアクセスする方法を決定します。タスクコレクション内からコメントを直接表示できるようにするために、タスクコレクション内に**一対多**の逆関係フィールドを作成し、コメントコレクションにリンクします。

タスクコレクションを再度開くと、関連コメントフィールドが**一対多**の関係として表示され、すべての関連コメントを簡単に表示および管理できるようになります！

## 4.3 ページの設定

### 4.3.1 コメントコレクションの有効化

今、エキサイティングな瞬間です：編集ポップアップに戻り、**コメントブロック**を作成し、必要な機能をチェックします。完了です！

![コメントテーブルを有効にする](https://static-docs.nocobase.com/Solution/demovv4-016.gif)

![ページのレイアウトを調整](https://static-docs.nocobase.com/Solution/demovv4-016-two.gif)

### 4.3.2 ページの調整

ページレイアウトを整えましょう。編集ボタンの右上にカーソルを合わせて、より広いポップアップを選択し、これまでに学んだことを使ってコメントブロックをポップアップの右側にドラッグしましょう。完璧です！

![ページのレイアウトを調整](https://static-docs.nocobase.com/Solution/demovv4-017.gif)

中には「私もコメント機能を設定したい！」と思う人もいるかもしれませんが、心配しないでください。もう一つの無料オプションを用意しています。

### 4.2.2 方法2：カスタムコメントコレクションの作成

コメントプラグインを購入していなければ、カスタムコレクションを作成することで類似のコメント機能を設定できます。

1. **新しいコメントコレクションを作成**：
   - **コメントコレクション（comments2）**を作成し、**コメント内容（content）**フィールド（マークダウンタイプ）と**関連タスク（belong_task）**フィールド（多対一タイプ）を追加します。
     ![](https://static-docs.nocobase.com/Solution/202411070034011730910841.png)
2. **ページにコメントリストブロックを作成**：
   - タスクコレクションの編集ポップアップで[**リストブロック**](https://docs-nocobase.com/handbook/ui/blocks/data-blocks/list)（3種類目のブロック、フィールドの詳細情報を表示できます）を追加し、コメントを選択してテストします：
     ![コメントリストブロックを作成](https://static-docs.nocobase.com/Solution/demovv4-018-two.gif)

## まとめ

これで、マークダウン (Vditor)を使ってタスク内容を豊かにし、タスクにコメント機能を追加する方法が分かりました！タスク管理システムは、完全な機能基盤を持つことになりました。これで、プロフェッショナルなタスク管理ツールを作成する新しい一歩を踏み出しましたね！

引き続き探索し、実践してください。NocoBaseには無限の可能性があります。問題が発生しても心配しないでください – 各ステップを案内しますので！

[次の章（第5章：タブ＆ダイナミックブロック）](https://www.nocobase.com/en/tutorials/task-tutorial-tabs-blocks)では、NocoBaseでのブロック機能についてさらに深く掘り下げ、システムを次のレベルに引き上げる手助けをします。素晴らしい作業を続けいてください！

---

自由に探索し、創造性を発揮しましょう！困難に直面した場合は、[NocoBase公式ドキュメント](https://docs-cn.nocobase.com/)を参照するか、[NocoBaseコミュニティ](https://forum.nocobase.com/)に参加して議論してください。